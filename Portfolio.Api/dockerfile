#  Dockerfile (En la carpeta Portfolio.Api/)

# ETAPA 1: Construcci贸n (Build)
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

#  CORRECCIN DE RUTAS: COPIAMOS EL ARCHIVO DE SOLUCIN Y LOS PROYECTOS DESDE LA RAZ 

# Copiar el archivo de soluci贸n (.sln) y el proyecto de la API
COPY ../PortfolioSolution.sln . 
COPY Portfolio.Api.csproj Portfolio.Api/

# 1. COPIAR LA CARPETA SHARED COMPLETA
# Usamos la notaci贸n 'subir un nivel' (../) para encontrar la carpeta Shared.
COPY ../Portfolio.Shared/Portfolio.Shared.csproj Portfolio.Shared/

# Copiar el resto de los archivos necesarios para la restauraci贸n
# Esto es esencial, ya que el .sln necesita ver los archivos .csproj para restaurar
COPY . .

# 2. Restaurar dependencias 
# Ahora el WORKDIR se mueve a la carpeta API para restaurar (asumiendo que el .csproj de la API es el que tiene las referencias)
WORKDIR /src/Portfolio.Api

RUN dotnet restore

# 3. Publicar (Se mantiene igual)
RUN dotnet publish "Portfolio.Api.csproj" -c Release -o /app/publish /p:UseAppHost=false
# ETAPA 2: Ejecuci贸n (Runtime)
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final
WORKDIR /app
COPY --from=build /app/publish .
EXPOSE 8080 
ENTRYPOINT ["dotnet", "Portfolio.Api.dll"]