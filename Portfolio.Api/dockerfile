# üìÑ Dockerfile (Ubicado en Portfolio.Api/)

# ETAPA 1: Construcci√≥n
FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
WORKDIR /src

# 2. Copiar los archivos .csproj usando la ruta desde la ra√≠z
# Como el contexto es la ra√≠z, copiamos "Portfolio.Api/..." hacia "Portfolio.Api/"
COPY Portfolio.Api/Portfolio.Api.csproj Portfolio.Api/
COPY Portfolio.Shared/Portfolio.Shared.csproj Portfolio.Shared/

# 3. Restaurar dependencias
RUN dotnet restore "Portfolio.Api/Portfolio.Api.csproj"

# 4. Copiar todo el c√≥digo fuente
COPY . .

# 5. Publicar
# Cambiamos al directorio del proyecto API para publicar
WORKDIR "/src/Portfolio.Api"
RUN dotnet publish "Portfolio.Api.csproj" -c Release -o /app/publish /p:UseAppHost=false

# ETAPA 2: Ejecuci√≥n
FROM mcr.microsoft.com/dotnet/aspnet:10.0 AS final
WORKDIR /app

RUN apt-get update && apt-get install -y libgssapi-krb5-2

COPY --from=build /app/publish .
EXPOSE 8080
ENTRYPOINT ["dotnet", "Portfolio.Api.dll"]