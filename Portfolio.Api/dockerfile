#  Portfolio.Api/Dockerfile

# ETAPA 1: Construcci贸n (Build)
# Usar la imagen SDK de .NET para compilar el c贸digo
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copiar el archivo .csproj del proyecto API
COPY ["Portfolio.Api/Portfolio.Api.csproj", "Portfolio.Api/"]
# Copiar el archivo .csproj del proyecto Shared
COPY ["Portfolio.Shared/Portfolio.Shared.csproj", "Portfolio.Shared/"]

# Copiar el archivo de soluci贸n y hacer referencia
COPY . .
WORKDIR "/src/Portfolio.Api"
RUN dotnet restore "Portfolio.Api.csproj"

# Construir la aplicaci贸n
RUN dotnet publish "Portfolio.Api.csproj" -c Release -o /app/publish /p:UseAppHost=false

# ETAPA 2: Ejecuci贸n (Runtime)
# Usar la imagen Runtime de .NET, mucho m谩s peque帽a y segura
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final
WORKDIR /app

# Copiar los archivos publicados de la etapa de construcci贸n
COPY --from=build /app/publish .

# Exponer el puerto por defecto de ASP.NET Core (Kestrel)
EXPOSE 8080 

# Comando de inicio: Ejecutar el archivo DLL
ENTRYPOINT ["dotnet", "Portfolio.Api.dll"]